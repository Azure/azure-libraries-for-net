<Project DefaultTargets="Init" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Import Project="Directory.Build.props" />	
	<Import Project="test.props" />
	<Import Project="AzSdk.props" />
	<Import Project="Directory.Build.targets" />
  
	<Target Name="Clean" DependsOnTargets="$(CleanTraversedProjectsDependsOn)" />
	<Target Name="Restore" DependsOnTargets="$(RestoreTraversedProjectsDependsOn)" /> 
	<Target Name="Build" DependsOnTargets="$(BuildTraversedProjectsDependsOn)" />
	<Target Name="Rebuild" DependsOnTargets="Clean;Build" />
	<Target Name="PublishNuget" DependsOnTargets="$(PublishNugetDependsOn)" />
	<Target Name="CreateNugetPackage" DependsOnTargets="$(PackageNugetDependsOn)" />
	<Target Name="RunTests" DependsOnTargets="$(RunTestProjectsDependsOn)" />
	<Target Name="SignNuget" DependsOnTargets="$(SignNugetDependsOn)" />
	<Target Name="Help" DependsOnTargets="$(HelpDependsOn)" />  

  <PropertyGroup>
    <Pdb2PdbCommand>&quot;$(LibraryToolsFolder)\Pdb2Pdb\Pdb2Pdb.exe&quot;</Pdb2PdbCommand>
  </PropertyGroup>
  
  <Target Name="PublishSymbols">

    <ItemGroup>
      <DllFiles Include="$(PackageOutputDir)\*.symbols\lib\**\*.dll">
      </DllFiles>
    </ItemGroup>

    <Message Text="Found dll files: &quot;%(DllFiles.Identity)&quot;" />  
    
    <MakeDir Directories="$(PackageOutputDir)\..\Symbols\%(DllFiles.RecursiveDir)" />

    <Exec Command="$(Pdb2PdbCommand) %(DllFiles.Identity) /out $(PackageOutputDir)\..\Symbols\%(DllFiles.RecursiveDir)\%(DllFiles.Filename).pdb" IgnoreExitCode="true" />

    <ItemGroup>  
        <ConvertedSymbols Include="$(PackageOutputDir)\..\Symbols\**\*.pdb"/>  
    </ItemGroup> 

    <Copy SourceFiles="@(ConvertedSymbols)" DestinationFolder="\\aaptfile01\ADXSDK\Fluent\" />

    <Exec Command="\\symbols\tools\createrequest.cmd -i tools\symbolPublish.txt -d .\requests -c -s" IgnoreExitCode="true" />      
  </Target>
</Project>
